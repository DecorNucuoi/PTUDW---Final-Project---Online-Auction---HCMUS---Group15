{{#section 'js'}}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <script >
    $('#email').on('blur', function () {
        const email = $(this).val();
        $.getJSON(`/account/is-available?email=${email}`, function (data) {
            if (data === false) {
                alert('Email already exists!');
                $('#email').addClass('is-invalid');
            } else {
                $('#email').removeClass('is-invalid');
            }
        });
    });

    document.querySelector('#frmSignup').addEventListener('submit', function (e) {
      e.preventDefault();
      const username = document.querySelector('#fullname').value.trim();
      if (username.length === 0) {
        alert('Fullname is required.');
        return;
      }
      const password = document.querySelector('#password').value;
      if (password.length < 6) {
        alert('Password must be at least 6 characters long.');
        return;
      }
      const confirmPassword = document.querySelector('#confirmpassword').value;
      if (password !== confirmPassword) {
        alert('Passwords do not match.');
        return;
      }
      const captcha = document.querySelector('#g-recaptcha-response').value;
      if (!captcha) {
         alert('Please check the captcha!');
         return;
      }
      e.target.submit();
    });
  </script>
{{/section}}

<div class="card">
  <h5 class="card-header">
    <i class="bi bi-person-plus"></i>
    User Registration
  </h5>
  <div class="card-body">
    {{#if err_message}}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{err_message}}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {{/if}}
    
    <form method="post" id ="frmSignup">
      <!-- Fullname -->
      <div class="row mb-3">
        <label for="username" class="col-sm-3 col-form-label">
          <i class="bi bi-person-circle"></i>
          Fullname
        </label>
        <div class="col-sm-9">
          <input type="text" class="form-control" id="fullname" name="fullname" placeholder="Enter fullname">
        </div>
      </div>

      <!-- Email -->
      <div class="row mb-3">
        <label for="email" class="col-sm-3 col-form-label">
          <i class="bi bi-envelope"></i>
          Email
        </label>
        <div class="col-sm-9">
          <input type="email" class="form-control" id="email" name="email" placeholder="Enter email address">
        </div>
      </div>

      <!-- Address -->
      <div class="row mb-3">
        <label for="address" class="col-sm-3 col-form-label">
          <i class="bi bi-house"></i>
          Address
        </label>
        <div class="col-sm-9">
          <input type="text" class="form-control" id="address" name="address" placeholder="Enter address">
        </div>
        </div>

      <!-- Password -->
      <div class="row mb-3">
        <label for="password" class="col-sm-3 col-form-label">
          <i class="bi bi-lock"></i>
          Password
        </label>
        <div class="col-sm-9">
          <input type="password" class="form-control" id="password" name="password" placeholder="Enter password">
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="row mb-3">
        <label for="confirmpassword" class="col-sm-3 col-form-label">
          <i class="bi bi-lock-fill"></i>
          Confirm Password
        </label>
        <div class="col-sm-9">
          <input type="password" class="form-control" id="confirmpassword" placeholder="Confirm password">
        </div>
      </div>

      <!-- RECAPTCHA DIV -->
      <div class="row mb-3">
         <div class="col-sm-9 offset-sm-3">
            <div class="g-recaptcha" data-sitekey="6LePyjcsAAAAACM0kBMKGezEwjRIlGVyuEKnZtXL"></div>
         </div>
      </div>


      <!-- Signup Button -->
      <div class="row">
        <div class="col-sm-9 offset-sm-3">
          <button type="submit" class="btn btn-outline-primary btn-lg w-100">
            <i class="bi bi-person-check"></i>
            Signup
          </button>
        </div>
      </div>
    </form>
  </div>
</div>