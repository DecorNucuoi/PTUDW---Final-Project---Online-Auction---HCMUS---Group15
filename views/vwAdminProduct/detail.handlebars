<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-box-seam"></i> Chi Tiết Sản Phẩm</h2>
        <a href="/admin/products" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
    </div>

    <div class="row">
        <!-- Product Information -->
        <div class="col-md-8">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Thông Tin Sản Phẩm</h5>
                </div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <tr>
                            <th width="30%">ID</th>
                            <td>{{product.id}}</td>
                        </tr>
                        <tr>
                            <th>Tên Sản Phẩm</th>
                            <td><strong>{{product.name}}</strong></td>
                        </tr>
                        <tr>
                            <th>Mô Tả</th>
                            <td>{{product.description}}</td>
                        </tr>
                        <tr>
                            <th>Danh Mục</th>
                            <td>{{category.name}}</td>
                        </tr>
                        <tr>
                            <th>Người Bán</th>
                            <td>{{product.seller_name}} (ID: {{product.seller_id}})</td>
                        </tr>
                        <tr>
                            <th>Giá Khởi Điểm</th>
                            <td class="text-success"><strong>{{product.starting_price}} VND</strong></td>
                        </tr>
                        <tr>
                            <th>Giá Hiện Tại</th>
                            <td class="text-danger"><strong>{{product.current_price}} VND</strong></td>
                        </tr>
                        <tr>
                            <th>Bước Giá</th>
                            <td>{{product.step_price}} VND</td>
                        </tr>
                        <tr>
                            <th>Giá Mua Ngay</th>
                            <td>{{#if product.buy_now_price}}{{product.buy_now_price}} VND{{else}}<em>Không có</em>{{/if}}</td>
                        </tr>
                        <tr>
                            <th>Thời Gian Bắt Đầu</th>
                            <td>{{product.start_time}}</td>
                        </tr>
                        <tr>
                            <th>Thời Gian Kết Thúc</th>
                            <td>{{product.end_time}}</td>
                        </tr>
                        <tr>
                            <th>Trạng Thái</th>
                            <td>
                                {{#if (isEqual product.status -1)}}
                                    <span class="badge bg-danger">Đã Gỡ Bỏ</span>
                                {{else if (isEqual product.status 0)}}
                                    <span class="badge bg-secondary">Nháp</span>
                                {{else if (isEqual product.status 1)}}
                                    <span class="badge bg-success">Đang Đấu Giá</span>
                                {{else if (isEqual product.status 2)}}
                                    <span class="badge bg-info">Đã Kết Thúc</span>
                                {{/if}}
                            </td>
                        </tr>
                        <tr>
                            <th>Tự Động Gia Hạn</th>
                            <td>{{#if product.auto_extend}}<span class="badge bg-success">Có</span>{{else}}<span class="badge bg-secondary">Không</span>{{/if}}</td>
                        </tr>
                        <tr>
                            <th>Cho Phép Người Mới</th>
                            <td>{{#if product.allow_newbie}}<span class="badge bg-success">Có</span>{{else}}<span class="badge bg-danger">Không</span>{{/if}}</td>
                        </tr>
                        <tr>
                            <th>Người Thắng</th>
                            <td>
                                {{#if product.winner_name}}
                                    {{product.winner_name}} (ID: {{product.winner_id}})
                                {{else}}
                                    <em>Chưa có</em>
                                {{/if}}
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Bid History -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Lịch Sử Đấu Giá ({{bids.length}} lượt)</h5>
                </div>
                <div class="card-body">
                    {{#if bids}}
                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Người Đấu</th>
                                    <th>Giá</th>
                                    <th>Thời Gian</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each bids}}
                                <tr>
                                    <td>{{this.full_name}} (ID: {{this.bidder_id}})</td>
                                    <td class="text-success"><strong>{{this.price}} VND</strong></td>
                                    <td>{{this.created_at}}</td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted">Chưa có lượt đấu giá nào.</p>
                    {{/if}}
                </div>
            </div>
        </div>

        <!-- Images & Actions -->
        <div class="col-md-4">
            <!-- Product Images -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Hình Ảnh ({{images.length}})</h5>
                </div>
                <div class="card-body">
                    {{#if images}}
                    <div id="productImagesCarousel" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            {{#each images}}
                            <div class="carousel-item {{#if this.is_thumbnail}}active{{/if}}">
                                <img src="{{this.image_url}}" class="d-block w-100" alt="Product Image">
                                {{#if this.is_thumbnail}}
                                <div class="badge bg-primary position-absolute top-0 start-0 m-2">Thumbnail</div>
                                {{/if}}
                            </div>
                            {{/each}}
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#productImagesCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#productImagesCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </button>
                    </div>
                    {{else}}
                    <p class="text-muted">Không có hình ảnh.</p>
                    {{/if}}
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="card shadow-sm">
                <div class="card-header bg-warning">
                    <h5 class="mb-0">Hành Động</h5>
                </div>
                <div class="card-body">
                    {{#if (isEqual product.status -1)}}
                    <!-- Restore Product -->
                    <form method="POST" action="/admin/products/restore" class="mb-2">
                        <input type="hidden" name="id" value="{{product.id}}">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="bi bi-arrow-counterclockwise"></i> Khôi Phục Sản Phẩm
                        </button>
                    </form>
                    <!-- Hard Delete -->
                    <button type="button" class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#hardDeleteModal">
                        <i class="bi bi-trash-fill"></i> Xóa Vĩnh Viễn
                    </button>
                    {{else}}
                    <!-- Soft Delete -->
                    <button type="button" class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#softDeleteModal">
                        <i class="bi bi-trash"></i> Gỡ Bỏ Sản Phẩm
                    </button>
                    {{/if}}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Soft Delete Confirmation Modal -->
<div class="modal fade" id="softDeleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title">Xác Nhận Gỡ Bỏ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn gỡ bỏ sản phẩm <strong>{{product.name}}</strong> không?</p>
                <p class="text-muted">Sản phẩm sẽ bị ẩn nhưng có thể khôi phục lại sau.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <form method="POST" action="/admin/products/soft-delete" style="display: inline;">
                    <input type="hidden" name="id" value="{{product.id}}">
                    <button type="submit" class="btn btn-warning">Gỡ Bỏ</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Hard Delete Confirmation Modal -->
<div class="modal fade" id="hardDeleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Xác Nhận Xóa Vĩnh Viễn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa vĩnh viễn sản phẩm <strong>{{product.name}}</strong> không?</p>
                <p class="text-danger"><strong>CẢNH BÁO:</strong> Hành động này không thể hoàn tác!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <form method="POST" action="/admin/products/hard-delete" style="display: inline;">
                    <input type="hidden" name="id" value="{{product.id}}">
                    <button type="submit" class="btn btn-danger">Xóa Vĩnh Viễn</button>
                </form>
            </div>
        </div>
    </div>
</div>
